rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    function signedIn() {
      return request.auth != null;
    }

    function isOwner(uid) {
      return signedIn() && request.auth.uid == uid;
    }

    // User private data: strict per-uid isolation.
    match /users/{uid}/{document=**} {
      allow read, write: if isOwner(uid);
    }

    // Story setup catalogs (read-only for clients).
    // Required shape: catalog/story_setup/{heroes,locations,styles,types}/{doc}
    match /catalog/story_setup/{document=**} {
      // Allow reads only for authenticated users.
      allow read: if signedIn();
      allow write: if false;
    }

    // Legacy/alternate shapes (kept read-only for authenticated users).
    match /story_setup/v1/{document=**} {
      allow read: if signedIn();
      allow write: if false;
    }

    match /heroes/{docId} {
      allow read: if signedIn();
      allow write: if false;
    }

    match /locations/{docId} {
      allow read: if signedIn();
      allow write: if false;
    }

    match /styles/{docId} {
      allow read: if signedIn();
      allow write: if false;
    }

    match /types/{docId} {
      allow read: if signedIn();
      allow write: if false;
    }

    // Explicit deny-by-default.
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
